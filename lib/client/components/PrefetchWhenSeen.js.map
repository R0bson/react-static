{"version":3,"sources":["../../../src/client/components/PrefetchWhenSeen.js"],"names":["ioIsSupported","window","handleIntersection","element","callback","io","IntersectionObserver","entries","forEach","entry","target","isIntersecting","intersectionRatio","unobserve","disconnect","observe","PrefetchWhenSeen","runPrefetch","props","path","onLoad","type","cleanedPath","data","handleRef","ref","component","render","children","rest","React","createElement","Component","defaultProps","className"],"mappings":";;;;;;;;;;;;;;AAAA;;;;AAEA;;AACA;;;;;;;;;;;;;;AAEA,IAAMA,gBAAgB,OAAOC,MAAP,KAAkB,WAAlB,IAAiC,0BAA0BA,MAAjF;AACA,IAAMC,qBAAqB,SAArBA,kBAAqB,CAACC,OAAD,EAAUC,QAAV,EAAuB;AAChD,MAAMC,KAAK,IAAIJ,OAAOK,oBAAX,CAAgC,mBAAW;AACpDC,YAAQC,OAAR,CAAgB,iBAAS;AACvB;AACA,UAAIL,YAAYM,MAAMC,MAAlB,KAA6BD,MAAME,cAAN,IAAwBF,MAAMG,iBAAN,GAA0B,CAA/E,CAAJ,EAAuF;AACrFP,WAAGQ,SAAH,CAAaV,OAAb;AACAE,WAAGS,UAAH;AACAV;AACD;AACF,KAPD;AAQD,GATU,CAAX;;AAWAC,KAAGU,OAAH,CAAWZ,OAAX;AACD,CAbD;;IAeqBa,gB;;;;;;;;;;;;;;;0MAenBC,W,GAAc;AAAA,aACZ,2DAAC;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,8BACgC,MAAKC,KADrC,EACSC,IADT,eACSA,IADT,EACeC,MADf,eACeA,MADf,EACuBC,IADvB,eACuBA,IADvB;AAEOC,2BAFP,GAEqB,uBAAUH,IAAV,CAFrB;AAAA;AAAA,uBAGoB,uBAASG,WAAT,EAAsB,EAAED,UAAF,EAAtB,CAHpB;;AAAA;AAGOE,oBAHP;;AAICH,uBAAOG,IAAP,EAAaD,WAAb;;AAJD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAD,IADY;AAAA,K,QAQdE,S,GAAY,eAAO;AACjB,UAAIxB,iBAAiByB,GAArB,EAA0B;AACxBvB,2BAAmBuB,GAAnB,EAAwB,MAAKR,WAA7B;AACD;AACF,K;;;;;wCAlBoB;AACnB,UAAI,CAACjB,aAAL,EAAoB;AAClB,aAAKiB,WAAL;AACD;AACF;;;6BAgBS;AAAA,mBAGJ,KAAKC,KAHD;AAAA,UAENQ,SAFM,UAENA,SAFM;AAAA,UAEKC,MAFL,UAEKA,MAFL;AAAA,UAEaC,QAFb,UAEaA,QAFb;AAAA,UAE0BC,IAF1B;;AAIR,UAAIH,SAAJ,EAAe;AACb,eAAOI,gBAAMC,aAAN,CAAoBL,SAApB,EAA+B;AACpCF,qBAAW,KAAKA;AADoB,SAA/B,CAAP;AAGD;AACD,UAAIG,MAAJ,EAAY;AACV,eAAOA,OAAO,EAAEH,WAAW,KAAKA,SAAlB,EAAP,CAAP;AACD;AACD,aACE;AAAA;AAAA,mBAAK,KAAK,KAAKA,SAAf,IAA8BK,IAA9B;AACGD;AADH,OADF;AAKD;;;;EA9C2CE,gBAAME,S;;AAA/BhB,gB,CACZiB,Y,GAAe;AACpBL,YAAU,IADU;AAEpBT,QAAM,IAFc;AAGpBe,aAAW,IAHS;AAIpBb,QAAM,IAJc;AAKpBD,UAAQ,kBAAM,CAAE;AALI,C;kBADHJ,gB","file":"PrefetchWhenSeen.js","sourcesContent":["import React from 'react'\n\nimport { cleanPath } from '../../utils/shared'\nimport { prefetch } from '../methods'\n\nconst ioIsSupported = typeof window !== 'undefined' && 'IntersectionObserver' in window\nconst handleIntersection = (element, callback) => {\n  const io = new window.IntersectionObserver(entries => {\n    entries.forEach(entry => {\n      // Edge doesn't support isIntersecting. intersectionRatio > 0 works as a fallback\n      if (element === entry.target && (entry.isIntersecting || entry.intersectionRatio > 0)) {\n        io.unobserve(element)\n        io.disconnect()\n        callback()\n      }\n    })\n  })\n\n  io.observe(element)\n}\n\nexport default class PrefetchWhenSeen extends React.Component {\n  static defaultProps = {\n    children: null,\n    path: null,\n    className: null,\n    type: null,\n    onLoad: () => {},\n  }\n\n  componentDidMount () {\n    if (!ioIsSupported) {\n      this.runPrefetch()\n    }\n  }\n\n  runPrefetch = () =>\n    (async () => {\n      const { path, onLoad, type } = this.props\n      const cleanedPath = cleanPath(path)\n      const data = await prefetch(cleanedPath, { type })\n      onLoad(data, cleanedPath)\n    })()\n\n  handleRef = ref => {\n    if (ioIsSupported && ref) {\n      handleIntersection(ref, this.runPrefetch)\n    }\n  }\n\n  render () {\n    const {\n      component, render, children, ...rest\n    } = this.props\n    if (component) {\n      return React.createElement(component, {\n        handleRef: this.handleRef,\n      })\n    }\n    if (render) {\n      return render({ handleRef: this.handleRef })\n    }\n    return (\n      <div ref={this.handleRef} {...rest}>\n        {children}\n      </div>\n    )\n  }\n}\n"]}