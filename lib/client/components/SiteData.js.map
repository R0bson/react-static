{"version":3,"sources":["../../../src/client/components/SiteData.js"],"names":["withSiteData","siteDataPromise","SiteData","state","siteData","process","env","REACT_STATIC_ENV","axios","get","data","unmounting","setState","props","component","render","children","rest","window","__routeInfo","context","routeInfo","finalProps","React","createElement","Component","contextTypes","PropTypes","object","Comp","ConnectedSiteData"],"mappings":";;;;;;;;;;;;;;QAiFgBA,Y,GAAAA,Y;;AAjFhB;;;;AACA;;;;AACA;;;;AAEA;;;;;;;;;;;;;;;AADA;;;AAGA;;AAEA,IAAIC,wBAAJ;;IAEqBC,Q;;;;;;;;;;;;;;0LAInBC,K,GAAQ;AACNC,gBAAU;AADJ,K;;;;;;;;;;;;;sBAIFC,QAAQC,GAAR,CAAYC,gBAAZ,KAAiC,a;;;;;;uBACD,YAAM;AACtC,sBAAIN,eAAJ,EAAqB;AACnB,2BAAOA,eAAP;AACD;AACDA,oCAAkBO,gBAAMC,GAAN,CAAU,4BAAV,CAAlB;AACA,yBAAOR,eAAP;AACD,iBANgC,E;;;;AAAnBG,wB,SAANM,I;;qBAOJ,KAAKC,U;;;;;;;;AAGT,qBAAKC,QAAL,CAAc;AACZR;AADY,iBAAd;;;;;;;;;;;;;;;;;;2CAKoB;AACtB,WAAKO,UAAL,GAAkB,IAAlB;AACD;;;6BACS;AAAA,mBAGJ,KAAKE,KAHD;AAAA,UAENC,SAFM,UAENA,SAFM;AAAA,UAEKC,MAFL,UAEKA,MAFL;AAAA,UAEaC,QAFb,UAEaA,QAFb;AAAA,UAE0BC,IAF1B;;AAIR,UAAIb,iBAAJ;;AAEA;AACA,UAAI,OAAOc,MAAP,KAAkB,WAAtB,EAAmC;AACjC,YAAIA,OAAOC,WAAX,EAAwB;AACtBf,qBAAWc,OAAOC,WAAP,CAAmBf,QAA9B;AACD;AACF;;AAED;AACA,UAAI,CAACA,QAAD,IAAa,KAAKgB,OAAL,CAAaC,SAA1B,IAAuC,KAAKD,OAAL,CAAaC,SAAb,CAAuBjB,QAAlE,EAA4E;AAC1EA,mBAAW,KAAKgB,OAAL,CAAaC,SAAb,IAA0B,KAAKD,OAAL,CAAaC,SAAb,CAAuBjB,QAA5D;AACD;;AAED;AACA,UAAI,CAACA,QAAD,IAAa,KAAKD,KAAL,CAAWC,QAA5B,EAAsC;AACpCA,mBAAW,KAAKD,KAAL,CAAWC,QAAtB;AACD;;AAED,UAAI,CAACA,QAAL,EAAe;AACb,YAAIC,QAAQC,GAAR,CAAYC,gBAAZ,KAAiC,aAArC,EAAoD;AAClD,iBAAO,8BAAC,oBAAD,OAAP;AACD;AACD,eAAO,IAAP;AACD;;AAED,UAAMe,0BACDL,IADC,EAEDb,QAFC,CAAN;AAIA,UAAIU,SAAJ,EAAe;AACb,eAAOS,gBAAMC,aAAN,CAAoBV,SAApB,EAA+BQ,UAA/B,EAA2CN,QAA3C,CAAP;AACD;AACD,UAAID,MAAJ,EAAY;AACV,eAAOA,OAAOO,UAAP,CAAP;AACD;AACD,aAAON,SAASM,UAAT,CAAP;AACD;;;;EApEmCC,gBAAME,S;;AAAvBvB,Q,CACZwB,Y,GAAe;AACpBL,aAAWM,oBAAUC;AADD,C;kBADH1B,Q;AAuEd,SAASF,YAAT,CAAuB6B,IAAvB,EAA6B;AAClC,SAAO,SAASC,iBAAT,CAA4BjB,KAA5B,EAAmC;AACxC,WAAO,8BAAC,QAAD,aAAU,WAAWgB,IAArB,IAA+BhB,KAA/B,EAAP;AACD,GAFD;AAGD","file":"SiteData.js","sourcesContent":["import React from 'react'\nimport PropTypes from 'prop-types'\nimport axios from 'axios'\n//\nimport DevSpinner from './DevSpinner'\n\n//\n\nlet siteDataPromise\n\nexport default class SiteData extends React.Component {\n  static contextTypes = {\n    routeInfo: PropTypes.object,\n  }\n  state = {\n    siteData: false,\n  }\n  async componentWillMount () {\n    if (process.env.REACT_STATIC_ENV === 'development') {\n      const { data: siteData } = await (() => {\n        if (siteDataPromise) {\n          return siteDataPromise\n        }\n        siteDataPromise = axios.get('/__react-static__/siteData')\n        return siteDataPromise\n      })()\n      if (this.unmounting) {\n        return\n      }\n      this.setState({\n        siteData,\n      })\n    }\n  }\n  componentWillUnmount () {\n    this.unmounting = true\n  }\n  render () {\n    const {\n      component, render, children, ...rest\n    } = this.props\n    let siteData\n\n    // Get siteInfo from window\n    if (typeof window !== 'undefined') {\n      if (window.__routeInfo) {\n        siteData = window.__routeInfo.siteData\n      }\n    }\n\n    // Get siteInfo from context (SSR)\n    if (!siteData && this.context.routeInfo && this.context.routeInfo.siteData) {\n      siteData = this.context.routeInfo && this.context.routeInfo.siteData\n    }\n\n    // Get siteInfo from request\n    if (!siteData && this.state.siteData) {\n      siteData = this.state.siteData\n    }\n\n    if (!siteData) {\n      if (process.env.REACT_STATIC_ENV === 'development') {\n        return <DevSpinner />\n      }\n      return null\n    }\n\n    const finalProps = {\n      ...rest,\n      ...siteData,\n    }\n    if (component) {\n      return React.createElement(component, finalProps, children)\n    }\n    if (render) {\n      return render(finalProps)\n    }\n    return children(finalProps)\n  }\n}\n\nexport function withSiteData (Comp) {\n  return function ConnectedSiteData (props) {\n    return <SiteData component={Comp} {...props} />\n  }\n}\n"]}