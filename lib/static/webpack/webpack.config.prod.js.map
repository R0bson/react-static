{"version":3,"sources":["../../../src/static/webpack/webpack.config.prod.js"],"names":["config","isNode","result","common","output","filename","libraryTarget","optimization","minimize","minimizer","target","externals","whitelist","module","rules","stage","plugins","webpack","EnvironmentPlugin","process","env","CaseSensitivePathsPlugin","optimize","LimitChunkCountPlugin","maxChunks","paths","ROOT","DIST","NODE_MODULES","SRC","REACT_STATIC_PUBLICPATH","REACT_STATIC_STAGING","stagingSiteRoot","stagingBasePath","siteRoot","basePath","REACT_STATIC_PUBLIC_PATH","REACT_STATIC_SITE_ROOT","REACT_STATIC_BASEPATH","splitChunks","chunks","minSize","minChunks","maxAsyncRequests","maxInitialRequests","automaticNameDelimiter","name","cacheGroups","vendors","test","priority","default","reuseExistingChunk","extrackCSSChunks","ExtractCssChunks","chunkFilename","extractCssChunks","styles","enforce","mode","context","path","resolve","__dirname","entry","publicPath","UglifyJsPlugin","cache","parallel","sourceMap","OptimizeCSSAssetsPlugin","alias","preact","react","modules","extensions","undefined","bundleAnalyzer","BundleAnalyzerPlugin","filter","d","devtool"],"mappings":"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","file":"webpack.config.prod.js","sourcesContent":["import webpack from 'webpack'\nimport path from 'path'\nimport CaseSensitivePathsPlugin from 'case-sensitive-paths-webpack-plugin'\nimport { BundleAnalyzerPlugin } from 'webpack-bundle-analyzer'\nimport UglifyJsPlugin from 'uglifyjs-webpack-plugin'\nimport nodeExternals from 'webpack-node-externals'\nimport ExtractCssChunks from 'extract-css-chunks-webpack-plugin'\nimport OptimizeCSSAssetsPlugin from 'optimize-css-assets-webpack-plugin'\nimport rules from './rules'\n\nfunction common (config) {\n  const {\n    ROOT, DIST, NODE_MODULES, SRC,\n  } = config.paths\n\n  // Trailing slash\n  process.env.REACT_STATIC_PUBLICPATH = process.env.REACT_STATIC_STAGING\n    ? `${config.stagingSiteRoot}/${config.stagingBasePath ? `${config.stagingBasePath}/` : ''}`\n    : `${config.siteRoot}/${config.basePath ? `${config.basePath}/` : ''}`\n  process.env.REACT_STATIC_PUBLIC_PATH = process.env.REACT_STATIC_PUBLICPATH\n\n  // Trailing slash mysiteroot.com/\n  process.env.REACT_STATIC_SITE_ROOT = `${\n    process.env.REACT_STATIC_STAGING ? config.stagingSiteRoot : config.siteRoot\n  }/`\n\n  // No slashes base/path\n  process.env.REACT_STATIC_BASEPATH = process.env.REACT_STATIC_STAGING\n    ? config.stagingBasePath\n    : config.basePath\n\n  const splitChunks = {\n    chunks: 'all',\n    minSize: 10000,\n    minChunks: 1,\n    maxAsyncRequests: 5,\n    maxInitialRequests: 5,\n    automaticNameDelimiter: '~',\n    name: true,\n    cacheGroups: {\n      vendors: {\n        test: /[\\\\/]node_modules[\\\\/]/,\n        priority: -10,\n        chunks: 'all',\n      },\n      default: {\n        minChunks: 2,\n        priority: -20,\n        reuseExistingChunk: true,\n      },\n    },\n  }\n\n  let extrackCSSChunks = new ExtractCssChunks({\n    filename: '[name].[chunkHash:8].css',\n    chunkFilename: '[id].[chunkHash:8].css',\n  })\n\n  if (!config.extractCssChunks) {\n    splitChunks.cacheGroups = {\n      styles: {\n        name: 'styles',\n        test: /\\.css$/,\n        chunks: 'all',\n        enforce: true,\n      },\n    }\n    extrackCSSChunks = new ExtractCssChunks({\n      filename: '[name].[chunkHash:8].css',\n    })\n  }\n  return {\n    mode: 'production',\n    context: path.resolve(__dirname, '../../../node_modules'),\n    entry: path.resolve(ROOT, config.entry),\n    output: {\n      filename: '[name].[hash:8].js', // dont use chunkhash, its not a chunk\n      chunkFilename: 'templates/[name].[chunkHash:8].js',\n      path: DIST,\n      publicPath: process.env.REACT_STATIC_PUBLICPATH || '/',\n    },\n    optimization: {\n      minimize: true,\n      minimizer: [\n        new UglifyJsPlugin({\n          cache: true,\n          parallel: true,\n          sourceMap: true, // set to true if you want JS source maps\n        }),\n        new OptimizeCSSAssetsPlugin({}),\n      ],\n      splitChunks,\n    },\n    module: {\n      rules: rules({ config, stage: 'prod', isNode: false }),\n    },\n    resolve: {\n      alias: config.preact\n        ? {\n          react: 'preact-compat',\n          'react-dom': 'preact-compat',\n        }\n        : {},\n      modules: [\n        path.resolve(__dirname, '../../../node_modules'),\n        'node_modules',\n        NODE_MODULES,\n        SRC,\n        DIST,\n      ],\n      extensions: ['.js', '.json', '.jsx'],\n    },\n    externals: [],\n    target: undefined,\n    plugins: [\n      new webpack.EnvironmentPlugin(process.env),\n      extrackCSSChunks,\n      new CaseSensitivePathsPlugin(),\n      config.bundleAnalyzer && new BundleAnalyzerPlugin(),\n    ].filter(d => d),\n    devtool: 'source-map',\n  }\n}\n\nexport default function ({ config, isNode }) {\n  const result = common(config)\n  if (!isNode) return result\n  result.output.filename = 'static.[chunkHash:8].js'\n  result.output.libraryTarget = 'umd'\n  result.optimization.minimize = false\n  result.optimization.minimizer = []\n  result.target = 'node'\n  result.externals = [\n    nodeExternals({\n      whitelist: ['react-universal-component', 'webpack-flush-chunks', 'react-static-routes'],\n    }),\n  ]\n  //\n  // module.rules\n  result.module.rules = rules({ config, stage: 'prod', isNode: true })\n  result.plugins = [\n    new webpack.EnvironmentPlugin(process.env),\n    new CaseSensitivePathsPlugin(),\n    new webpack.optimize.LimitChunkCountPlugin({\n      maxChunks: 1,\n    }),\n  ]\n  return result\n}\n"]}